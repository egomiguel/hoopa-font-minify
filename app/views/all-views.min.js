"use strict";angular.module("myApp.BranchesOffices",["ngRoute"]).config(["$routeProvider",function(e){e.when("/branches-offices",{templateUrl:"views/branches-offices/branches-offices.html",controller:"BranchesOfficesCtrl"})}]).controller("BranchesOfficesCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.BussinesProcess",["ngRoute"]).config(["$routeProvider",function(e){e.when("/bussinesprocess",{templateUrl:"views/bussinesProcess/bussinesProcess.html",controller:"BussinesProcessCtrl"})}]).controller("BussinesProcessCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.BussinesSystem",["ngRoute"]).config(["$routeProvider",function(e){e.when("/bussinessystem",{templateUrl:"views/bussinesSystem/bussinesSystem.html",controller:"BussinesSystemCtrl"})}]).controller("BussinesSystemCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.Charman",["ngRoute"]).config(["$routeProvider",function(e){e.when("/charman",{templateUrl:"views/charman/charman.html",controller:"CharmanCtrl"})}]).controller("CharmanCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.CoreTeam",["ngRoute"]).config(["$routeProvider",function(e){e.when("/coreteam",{templateUrl:"views/coreTeam/coreTeam.html",controller:"CoreTeamCtrl"})}]).controller("CoreTeamCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.DevHistory",["ngRoute"]).config(["$routeProvider",function(e){e.when("/devhistory",{templateUrl:"views/devHistory/devHistory.html",controller:"DevHistoryCtrl"})}]).controller("DevHistoryCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.FeaturedCases",["ngRoute"]).config(["$routeProvider",function(e){e.when("/featured-cases",{templateUrl:"views/featured-cases/featured-cases.html",controller:"FeaturedCasesCtrl"})}]).controller("FeaturedCasesCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.GroupHonors",["ngRoute"]).config(["$routeProvider",function(e){e.when("/grouphonors",{templateUrl:"views/groupHonors/groupHonors.html",controller:"GroupHonorsCtrl"})}]).controller("GroupHonorsCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.GroupIntroduction",["ngRoute"]).config(["$routeProvider",function(e){e.when("/groupIntroduction",{templateUrl:"views/groupIntroduction/groupIntroduction.html",controller:"GroupIntroductionCtrl"})}]).controller("GroupIntroductionCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.Home",["ngRoute"]).config(["$routeProvider",function(e){e.when("/home",{templateUrl:"views/home/home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$rootScope","$scope",function(e,t){e.showBanner=!0,t.productsShop=[],t.productsFactory=[],t.productsHouse=[],t.productsHot=[],t.projectActive=1,t.fetchProjectHot=function(){var e=new AV.Query("Project");e.equalTo("isHot",!0),e.limit("4"),e.descending("createdAt"),e.find().then(function(e){for(var o=0;o<e.length;o++){if(e[o].get("description").length>=50){for(var r="",n=0;n<50;n++)r+=e[o].get("description")[n];r+="...",e[o].set("description",r)}e[o].mainImage=e[o].get("image").thumbnailURL(320,200)}t.productsHot=e,t.$apply()})},t.fetchProjectHouse=function(){var e=new AV.Query("Project");e.equalTo("isHouse",!0),e.limit("4"),e.descending("createdAt"),e.find().then(function(e){for(var o=0;o<e.length;o++){if(e[o].get("description").length>=50){for(var r="",n=0;n<50;n++)r+=e[o].get("description")[n];r+="...",e[o].set("description",r)}e[o].mainImage=e[o].get("image").thumbnailURL(320,200)}t.productsHouse=e,t.$apply()})},t.fetchProjectFactory=function(){var e=new AV.Query("Project");e.equalTo("isFactory",!0),e.limit("4"),e.descending("createdAt"),e.find().then(function(e){for(var o=0;o<e.length;o++){if(e[o].get("description").length>=50){for(var r="",n=0;n<50;n++)r+=e[o].get("description")[n];r+="...",e[o].set("description",r)}e[o].mainImage=e[o].get("image").thumbnailURL(320,200)}t.productsFactory=e,t.$apply()})},t.fetchProjectShop=function(){var e=new AV.Query("Project");e.equalTo("isShop",!0),e.limit("4"),e.descending("createdAt"),e.find().then(function(e){for(var o=0;o<e.length;o++){if(e[o].get("description").length>=50){for(var r="",n=0;n<50;n++)r+=e[o].get("description")[n];r+="...",e[o].set("description",r)}e[o].mainImage=e[o].get("image").thumbnailURL(320,200)}t.productsShop=e,t.$apply()})},t.changeActive=function(e){switch(t.projectActive=e,e){case 1:t.fetchProjectHot();break;case 2:t.fetchProjectHouse();break;case 3:t.fetchProjectFactory();break;case 4:t.fetchProjectShop();break;default:t.fetchProjectHot()}},t.changeActive(1),t.goToProject=function(t){e.customGoTo("project-details/"+t)},$(window).load("/app/views/home/home.js",function(){$("span.rn-carousel-control-next").addClass("icon-next"),$("span.rn-carousel-control-prev").addClass("icon-previous")})}]),angular.module("myApp.Login",["ngRoute"]).config(["$routeProvider",function(e){e.when("/login/:uriOption",{templateUrl:"views/login/login.html",controller:"LoginCtrl"})}]).config(["$routeProvider",function(e){e.when("/login/:uriOption/:id",{templateUrl:"views/login/login.html",controller:"LoginCtrl"})}]).controller("LoginCtrl",["$rootScope","$scope","$routeParams","$translate",function(e,t,o,r){$("html,body").scrollTop(0),e.showBanner=!1,t.phoneNumber="",t.smsCode="",t.option=o.uriOption,t.id=o.id||"",t.goToProject=function(t){e.customGoTo("project-details/"+t)},t.loginWithSmsCode=function(){AV.User.signUpOrlogInWithMobilePhone(t.phoneNumber,t.smsCode).then(o=>{e.getUser(),e.initWishList(),e.initOffersList(),""!=t.id?e.customGoTo(t.option+"/"+t.id):e.customGoTo(t.option)}).catch(function(e){console.log(e)})},t.requestSmsCode=function(){AV.Cloud.requestSmsCode(t.phoneNumber).then(t=>{var o=r.instant("SMSSENDED");e.displayAlert("success",o)}).catch(function(t){e.displayAlert("danger",t)})}}]),angular.module("myApp.News",["ngRoute"]).config(["$routeProvider",function(e){e.when("/news/:param1",{templateUrl:"views/news/news.html",controller:"NewsCtrl"})}]).controller("NewsCtrl",["$rootScope","$scope","$routeParams","$window",function(e,t,o,r){e.showBanner=!1,t.activeSideBar=o.param1,t.news=[],t.newsPagination=0,t.page=1,e.activeList="news",t.skip=0,t.pagNum=[],t.loading=!1,t.month=new Array,t.month[0]="January",t.month[1]="February",t.month[2]="March",t.month[3]="April",t.month[4]="May",t.month[5]="June",t.month[6]="July",t.month[7]="August",t.month[8]="September",t.month[9]="October",t.month[10]="November",t.month[11]="December",t.init=function(){t.loading=!0,new AV.Query("News").count().then(function(e){if(e>=5)if(e%5==0){t.newsPagination=parseInt(e/5);for(var o=1;o<t.newsPagination;o++)t.pagNum[o-1]=o}else{t.newsPagination=parseInt(e/5)+1;for(o=1;o<=t.newsPagination;o++)t.pagNum[o-1]=o}else t.newsPagination=0;t.$apply()});var e=new AV.Query("News");e.limit(5),e.find().then(function(e){t.news=[],e.forEach(function(e,o){var r=e.get("image").thumbnailURL(360,240),n=e.get("title"),i=e.get("content"),a=e.id,c=e.get("createdAt");t.news.push({id:a,mainImage:r,title:n,content:i,date:c}),t.getNewsMedia(e,t.news,o),t.$apply()}),t.loading=!1,t.$apply()}).catch(function(e){t.loading=!1,t.$apply(),alert(JSON.stringify(e))})},t.init(),t.getNewsMedia=function(e,o,r){var n=[],i=new AV.Query("NewsMedia");i.equalTo("news",e),i.find().then(function(e){e.forEach(function(e){if(e.get("image")){var t=e.get("image").thumbnailURL(360,240);n.push({image:t})}}),o[r].newsMedia=n,t.$apply()})},t.next=function(){t.page+=1,t.skip+=5;var e=new AV.Query("News");e.limit(5),e.skip(t.skip),e.find().then(function(e){t.news=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(720,480),r=e.get("title"),n=e.get("content"),i=e.id;t.news.push({id:i,mainImage:o,title:r,content:n}),$("html,body").scrollTop(0),t.$apply()}),t.$apply()}).catch(function(e){t.loading=!1,t.$apply(),alert(JSON.stringify(e))})},t.previous=function(){if(t.skip>=5){t.page-=1,t.skip-=5;var e=new AV.Query("News");e.limit(5),e.skip(t.skip),e.find().then(function(e){t.news=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(720,480),r=e.get("title"),n=e.get("content"),i=e.id;t.news.push({id:i,mainImage:o,title:r,content:n}),$("html,body").scrollTop(0),t.$apply()}),t.$apply()}).catch(function(e){t.loading=!1,t.$apply(),alert(JSON.stringify(e))})}},t.goToNews=function(e){localStorageService.cookie.set("newsId",t.news[e].id)},t.deleteNews=function(e){AV.Object.createWithoutData("News",e).destroy().then(function(e){t.init()})},t.ChangeNews=function(e){t.activeSideBar=e},t.goToPage=function(e){t.page=e,t.skip=5*(e-1);var o=new AV.Query("News");o.limit(5),o.skip(t.skip),o.find().then(function(e){t.news=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(720,480),r=e.get("title"),n=e.get("content"),i=e.id;t.news.push({id:i,mainImage:o,title:r,content:n}),$("html,body").scrollTop(0),t.$apply()}),t.$apply()}).catch(function(e){t.loading=!1,t.$apply(),alert(JSON.stringify(e))})},t.goToProject=function(t){e.customGoTo("viewNews/"+t)}}]),angular.module("myApp.OrganizationStructure",["ngRoute"]).config(["$routeProvider",function(e){e.when("/organizationStructure",{templateUrl:"views/organizationStructure/organizationStructure.html",controller:"OrganizationStructureCtrl"})}]).controller("OrganizationStructureCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.projects=[],t.init=function(){var e=new AV.Query("Project");e.limit(5),e.equalTo("isRecommended",!0),e.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.get("debitAmount"),i=e.id;t.projects.push({id:i,mainImage:o,title:r,amount:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init()}]),angular.module("myApp.ProjectDetails",["ngRoute"]).config(["$routeProvider",function(e){e.when("/project-details/:id",{templateUrl:"views/project-details/project-details.html",controller:"ProjectDetailsCtrl"})}]).controller("ProjectDetailsCtrl",["$rootScope","$scope","$routeParams","$translate",function(e,t,o,r){$("html,body").scrollTop(0),e.showBanner=!1,t.tabAssetsVisible=!0,t.tabBorrowersVisible=!1,t.tabSponsorsVisible=!1,t.tabCommentsVisible=!1,t.titleReview="",t.ratingReview="",t.contentReview="",t.reviews=[],t.totalOffers=0,t.promOffers=0,t.offerValue=0,t.projectId=o.id,t.project={},t.sponsorsList=[],t.assetsList=[],t.borrowerList=[],t.imageList=[],t.projects=[],t.imageOpenModal=0,t.countVisit=0,t.countOffers=0,t.countShopCar=0,e.activeList="projects",t.projectTitle="",t.projectCompany="",t.projectDescription="",t.projectDebitAmount="",t.projectPrincipal="",t.projectComeFrom="",t.projectProvince="",t.projectAddress="",t.projectCredits="",t.projectManagerId="",t.projectManagerName="",t.projectManagerPhone="",t.projectHot=!1,t.projectHouse=!1,t.projectRecommended=!1,t.projectFactory=!1,t.projectDebt=!1,t.projectShop=!1,t.init=function(){var e=t.projectId,o=new AV.Query("Project");o.include("projectManager"),o.get(e).then(function(e){t.project=e,t.project.wished=!1,t.fectComments(),t.projectTitle=e.get("title"),t.projectCompany=e.get("companyName"),t.projectDescription=e.get("description"),t.projectDebitAmount=e.get("debitAmount"),t.projectPrincipal=e.get("debitPricipalInterest"),t.projectComeFrom=e.get("comefrom"),t.projectProvince=e.get("province"),t.projectAddress=e.get("plainAddress"),t.projectCredits=e.get("creditHighlights"),t.projectManagerId=e.get("projectManager").id,t.projectManagerName=e.get("projectManager").get("name"),t.projectManagerPhone=e.get("projectManager").get("phone"),t.projectHot=e.get("isHot"),t.projectHouse=e.get("isHouse"),t.projectRecommended=e.get("isRecommended"),t.projectFactory=e.get("isFactory"),t.projectDebt=e.get("isDebt"),t.projectShop=e.get("isShop");var o=new AV.Query("Sponsorship");o.equalTo("project",e),o.find().then(function(e){t.sponsorsList=e,t.$apply()});var r=new AV.Query("Asset");r.equalTo("project",e),r.find().then(function(e){t.assetsList=e,t.$apply()});var n=new AV.Query("Borrower");n.equalTo("project",e),n.find().then(function(e){for(var o=0;o<e.length;o++)e[o].set("totalInterest",parseFloat(e[o].get("principalDebit"))+parseFloat(e[o].get("interestCreditor")));t.borrowerList=e,t.$apply()});var i=new AV.Query("ProjectMedia");i.equalTo("project",e),i.find().then(function(e){console.log(e.length);for(var o=0;o<e.length;o++)e[o].set("imageUrl",e[o].get("image").thumbnailURL(200,150)),e[o].set("url",e[o].get("image").thumbnailURL(1280,720));t.imageList=e,t.$apply()});var a=new AV.Query("ProjectVisit");a.equalTo("project",e),a.count().then(function(e){t.countVisit=e,t.$apply()});var c=new AV.Query("ShopCar");c.equalTo("project",e),c.count().then(function(e){t.countShopCar=e,t.$apply()});var s=new AV.Query("Offert");s.equalTo("project",e),s.count().then(function(e){t.countOffers=e,t.$apply()});var u=new AV.Query("ShopCar");u.equalTo("project",e),u.equalTo("user",AV.User.current()),u.count().then(e=>{e>0&&(t.project.wished=!0),t.$apply()});var l=new AV.Query("Offert");l.equalTo("project",e),l.find().then(function(e){t.totalOffers=e.length;for(var o=0,r=0;r<t.totalOffers;r++)o+=parseFloat(e[r].get("amount"));t.promOffers=parseFloat(o/t.totalOffers),t.promOffers=Math.round(t.promOffers*Math.pow(10,2))/Math.pow(10,2),t.$apply()}),t.$apply()});var r=new AV.Query("Project");r.limit(5),r.equalTo("isRecommended",!0),r.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.get("title"),n=e.id,i=e.get("debitAmount");t.projects.push({id:n,mainImage:o,title:r,amount:i}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init(),t.goToProject=function(t){e.customGoTo("project-details/"+t)},t.publishReview=function(){var e=AV.User.current();if(e&&""!=t.ratingReview&&""!=t.contentReview){var o=new AV.Object("ForumComment");o.set("content",t.contentReview),o.set("user",e),o.set("rating",t.ratingReview),o.set("avatarUrl",e.get("avatarUrl"));var r=AV.Object.createWithoutData("Project",t.project.id);o.set("project",r);var n=new AV.ACL;n.setPublicReadAccess(!0),n.setPublicWriteAccess(!0),o.setACL(n),o.save().then(function(e){e.createdAt=e.createdAt.toLocaleDateString("zh-CN")+" "+e.createdAt.toLocaleTimeString("zh-CN");var o=parseInt(e.get("rating"));e.rating=[5];for(var r=0;r<o;r++)e.rating[r]={id:r,class:"text-default"};for(var n=o;n<5;n++)e.rating[n]={id:r,class:""};t.reviews.push(e),t.ratingReview="",t.contentReview="",t.$apply()}).catch(function(e){console.log(e)})}},t.fectComments=function(){if(AV.User.current()){var e=new AV.Query("ForumComment");e.equalTo("project",t.project),e.find().then(function(e){t.reviews=[];for(var o=0;o<e.length;o++){e[o].createdAt=e[o].createdAt.toLocaleDateString("zh-CN")+" "+e[o].createdAt.toLocaleTimeString("zh-CN");var r=parseInt(e[o].get("rating"));e[o].rating=[5];for(var n=0;n<r;n++)e[o].rating[n]={id:n,class:"text-default"};for(var i=r;i<5;i++)e[o].rating[i]={id:n,class:""}}console.log(e),t.reviews=e})}},t.addToWhishList=function(){var o=AV.User.current();if(o){var n=AV.Object.createWithoutData("Project",t.project.id),i=new AV.Query("ShopCar");i.equalTo("project",n),i.equalTo("user",o),i.count().then(i=>{if(i>0){var a=r.instant("ALREADYINWISHLIST");e.displayAlert("warning",a)}else{var c=new AV.Object("ShopCar");c.set("user",o),c.set("checked",!1),c.set("project",n),c.save().then(o=>{var n=r.instant("ADDEDWISHLIST");e.displayAlert("success",n),t.project.wished=!0,t.$apply()})}})}else e.customGoTo("login/projects")},t.removeToWhishList=function(){var o=AV.User.current();if(o){var n=AV.Object.createWithoutData("Project",t.project.id),i=new AV.Query("ShopCar");i.equalTo("project",n),i.equalTo("user",o),i.find().then(o=>{o.forEach(function(o){o.destroy();var n=r.instant("REMOVEDWISHLIST");e.displayAlert("success",n),t.project.wished=!1,t.$apply()})})}},t.flagBid=!1,t.bid="",t.makeAnOffer=function(){AV.User.current()?t.flagBid=!t.flagBid:e.customGoTo("login/project-details/"+t.project.id)},t.makeABid=function(){var o=AV.User.current();if(o){var n=AV.Object.createWithoutData("Project",t.project.id),i=new AV.Object("Offert");i.set("user",o),i.set("project",n),i.set("amount",t.offerValue),i.set("pending",!0);var a=new AV.ACL;a.setPublicReadAccess(!0),a.setPublicWriteAccess(!0),i.setACL(a),i.save(),t.offerValue=0,t.flagBid=!t.flagBid;var c=r.instant("OFFERMADE");e.displayAlert("success",c);var s=new AV.Query("Offert");s.equalTo("project",n),s.find().then(function(e){t.totalOffers=e.length;for(var o=0,r=0;r<t.totalOffers;r++)o+=parseFloat(e[r].get("amount"));t.promOffers=parseFloat(o/t.totalOffers),t.promOffers=Math.round(t.promOffers*Math.pow(10,2))/Math.pow(10,2),t.$apply()})}else e.customGoTo("login/project-details/"+t.project.id)}}]),angular.module("myApp.Projects",["ngRoute"]).config(["$routeProvider",function(e){e.when("/projects",{templateUrl:"views/projects/projects.html",controller:"ProjectsCtrl"})}]).controller("ProjectsCtrl",["$rootScope","$scope","$routeParams","$window","$translate",function(e,t,o,r,n){e.showBanner=!1,t.products=[],t.currentPage=1,t.pageSize=8,t.productsCount=0,t.phoneNumber="",t.smsCode="",t.provinces=["区域无限制","安徽省","北京市","重庆市","福建省","广东省","甘肃省","广西壮族自治区","贵州省","河南省","湖北省","河北省","海南省","香港特别行政区","黑龙江省","湖南省","吉林省","江苏省","江西省","辽宁省","澳门特别行政区","內蒙古自治区","宁夏回族自治区","青海省","四川省","山东省","上海市","陕西省","山西省","天津市","台湾省","新疆维吾尔自治区","西藏自治区","云南省","浙江省"],t.typeArrivalArray=["抵押物类型","住宅","商铺","写字楼","厂房","在建工程","机械设备，存货，原材料","土地（无厂房","林权","海城使用权","商住","无抵押","其他"],t.amountArray=["本金无限制","500万","500-1000万","1000-1500万","1500-2000万","2000-2500万","2500-3000万","3000-3500万","3500-4000万","4000-4500万","4500-5000万","5000-5500万","5500-6000万","6000万"],t.filters={province:"区域无限制",type:"抵押物类型",amount:"本金无限制",text:""},t.resetFilters=function(){e.searchFilterText="",t.filters={province:"区域无限制",type:"抵押物类型",amount:"本金无限制",text:""}},t.$on("searchTextUpdated",function(o,r){t.filters.text=e.searchFilterText,t.applyFilters()}),t.applyFilters=function(){t.products=[];var e=AV.User.current(),o=new AV.Query("Project");"抵押物类型"!=t.filters.type&&o.contains("typeArrivalString",t.filters.type);var r=new AV.Query("Project");"区域无限制"!=t.filters.province&&r.contains("provinceString",t.filters.province);var n="";switch(t.filters.amount){case"本金无限制":n=new AV.Query("Project");break;case"500万":(n=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",500);break;case"500-1000万":(i=new AV.Query("Project")).greaterThan("debitAmount",500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",1e3);n=AV.Query.and(i,a);break;case"1000-1500万":(i=new AV.Query("Project")).greaterThan("debitAmount",1e3),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",1500);n=AV.Query.and(i,a);break;case"1500-2000万":(i=new AV.Query("Project")).greaterThan("debitAmount",1500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",2e3);n=AV.Query.and(i,a);break;case"2000-2500万":(i=new AV.Query("Project")).greaterThan("debitAmount",2e3),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",2500);n=AV.Query.and(i,a);break;case"2500-3000万":(i=new AV.Query("Project")).greaterThan("debitAmount",2500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",3e3);n=AV.Query.and(i,a);break;case"3000-3500万":(i=new AV.Query("Project")).greaterThan("debitAmount",3e3),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",3500);n=AV.Query.and(i,a);break;case"3500-4000万":(i=new AV.Query("Project")).greaterThan("debitAmount",3500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",4e3);n=AV.Query.and(i,a);break;case"4000-4500万":(i=new AV.Query("Project")).greaterThan("debitAmount",4e3),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",4500);n=AV.Query.and(i,a);break;case"4500-5000万":(i=new AV.Query("Project")).greaterThan("debitAmount",4500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",5e3);n=AV.Query.and(i,a);break;case"5000-5500万":(i=new AV.Query("Project")).greaterThan("debitAmount",5e3),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",5500);n=AV.Query.and(i,a);break;case"5500-6000万":var i,a;(i=new AV.Query("Project")).greaterThan("debitAmount",5500),(a=new AV.Query("Project")).lessThanOrEqualTo("debitAmount",6e3);n=AV.Query.and(i,a);break;case"6000万":(n=new AV.Query("Project")).greaterThan("debitAmount",6e3);break;default:n=new AV.Query("Project")}var c=AV.Query.and(r,n,o),s=new AV.Query("Project");s.contains("title",t.filters.text);var u=new AV.Query("Project");u.contains("description",t.filters.text);var l=AV.Query.or(u,s),p=AV.Query.and(c,l);p.count().then(function(e){t.productsCount=e}),p.limit(t.pageSize),p.skip((t.currentPage-1)*t.pageSize),p.descending("createdAt"),p.find().then(function(o){o.forEach(function(o,r){var n=o.id,i=o.get("title"),a=i;if(i.length>25){a="";for(var c=0;c<25;c++)a+=i[c];a+="..."}i=a;var s=o.get("description"),u=s;if(s.length>50){u="";for(c=0;c<50;c++)u+=s[c];u+="..."}s=u;var l,p=o.createdAt.getMonth()+1+"/"+o.createdAt.getDate()+"/"+o.createdAt.getFullYear(),m=o.get("creator").get("username"),g=o.get("image"),d=o.get("debitAmount"),f=o.get("plainAddress");l=g?g.thumbnailURL(320,200):"img/LogoHoopa.png",t.products.push({id:n,imageUrl:l,title:i,description:s,debitAmount:d,plainAddress:f,ownerUsername:m,releaseTime:p,wished:!1}),e&&t.setWish(t.products,r,o,e),t.$apply()}),t.loading=!1,t.$apply()}).catch(function(e){t.loading=!1,t.$apply(),console.log(e)})},t.applyFiltersClick=function(){t.currentPage=1,t.applyFilters()},t.setWish=function(e,o,r,n){var i=new AV.Query("ShopCar");i.equalTo("project",r),i.equalTo("user",n),i.count().then(r=>{r>0&&(e[o].wished=!0),t.$apply()})},t.applyFilters(),t.begin=function(){t.currentPage=1,t.applyFilters(),$("html,body").scrollTop(0)},t.end=function(){var e=Math.floor(t.productsCount/t.pageSize),o=t.productsCount%t.pageSize;t.currentPage=e,o>0&&(t.currentPage=e+1),t.applyFilters(),$("html,body").scrollTop(0)},t.nextPage=function(){var e=Math.floor(t.productsCount/t.pageSize),o=t.productsCount%t.pageSize;t.currentPage==e&&o>0&&(t.currentPage=e+1),t.currentPage<e&&(t.currentPage=t.currentPage+1),t.applyFilters(),$("html,body").scrollTop(0)},t.previousPage=function(){t.currentPage>1&&(t.currentPage=t.currentPage-1,t.applyFilters()),$("html,body").scrollTop(0)},t.goToProject=function(t){e.customGoTo("project-details/"+t)},t.addToWhishList=function(o){var r=AV.User.current();if(r){var i=AV.Object.createWithoutData("Project",o),a=new AV.Query("ShopCar");a.equalTo("project",i),a.equalTo("user",r),a.count().then(o=>{if(o>0){var a=n.instant("ALREADYINWISHLIST");e.displayAlert("warning",a)}else{var c=new AV.Object("ShopCar");c.set("user",r),c.set("checked",!1),c.set("project",i),c.save().then(o=>{var r=n.instant("ADDEDWISHLIST");e.displayAlert("success",r),t.applyFilters()})}})}else e.customGoTo("login/projects")},t.removeToWhishList=function(o){var r=AV.User.current();if(r){var i=AV.Object.createWithoutData("Project",o),a=new AV.Query("ShopCar");a.equalTo("project",i),a.equalTo("user",r),a.find().then(o=>{o.forEach(function(t){t.destroy();var o=n.instant("REMOVEDWISHLIST");e.displayAlert("success",o)}),t.applyFilters()})}}}]),angular.module("myApp.ViewNews",["ngRoute"]).config(["$routeProvider",function(e){e.when("/viewNews/:param1",{templateUrl:"views/viewNews/viewNews.html",controller:"ViewNewsCtrl"})}]).controller("ViewNewsCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){e.showBanner=!1,t.new={},t.news=[],t.projects=[],t.date="",t.newsMedia=[],t.projectId=o.param1,t.month=new Array,t.month[0]="January",t.month[1]="February",t.month[2]="March",t.month[3]="April",t.month[4]="May",t.month[5]="June",t.month[6]="July",t.month[7]="August",t.month[8]="September",t.month[9]="October",t.month[10]="November",t.month[11]="December",t.init=function(){new AV.Query("News").get(t.projectId).then(function(e){t.new=e,t.date=e.createdAt;var o=new AV.Query("NewsMedia");o.equalTo("news",e),o.find().then(function(e){t.newsMedia=e,t.$apply()}),t.$apply()});var e=new AV.Query("News");e.limit(5),e.find().then(function(e){t.news=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(60,40),r=e.get("title"),n=e.get("content"),i=e.id;t.news.push({id:i,mainImage:o,title:r,content:n}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))});var o=new AV.Query("Project");o.limit(5),o.equalTo("isRecommended",!0),o.find().then(function(e){t.projects=[],e.forEach(function(e){var o=e.get("image").thumbnailURL(260,160),r=e.id;t.projects.push({id:r,mainImage:o}),t.$apply()}),t.$apply()}).catch(function(e){alert(JSON.stringify(e))})},t.init(),t.goToNew=function(t){e.customGoTo("viewNews/"+t)},t.goToNews=function(){e.customGoTo("news/1")},t.goToProject=function(e){console.log(e)}}]),angular.module("myApp.Wishlist",["ngRoute"]).config(["$routeProvider",function(e){e.when("/wishlist",{templateUrl:"views/wishlist/wishlist.html",controller:"WishlistCtrl"})}]).controller("WishlistCtrl",["$rootScope","$scope","$routeParams",function(e,t,o){$("html,body").scrollTop(0),e.showBanner=!1,t.shopCartArray=[],t.init=function(){var e=AV.User.current();if(e){var o=new AV.Query("ShopCar");o.equalTo("user",e),o.include("image"),o.include("project"),o.descending("createdAt"),o.find().then(e=>{for(var o=0;o<e.length;o++){var r=e[o].get("project").get("description");if(e[o].get("project").get("description").length>30){r="";for(var n=0;n<30;n++)r+=e[o].get("project").get("description")[n];r+="..."}e[o].get("project").set("description",r)}t.shopCartArray=e,t.$apply()})}},t.init(),t.goToProject=function(t){e.customGoTo("project-details/"+t)}}]);